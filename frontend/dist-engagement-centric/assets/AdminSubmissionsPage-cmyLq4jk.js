import{j as e}from"./index-B207SZID.js";import{r as s}from"./react-vendor-B4Ig0bS4.js";import{a as i}from"./ui-vendor-B5K7MVzt.js";const a="/api";function t(){const[t,l]=s.useState([]),[n,d]=s.useState([]),[c,r]=s.useState(null),[o,u]=s.useState("all"),[m,h]=s.useState("pending"),[j,x]=s.useState(!0),[b,p]=s.useState(""),[v,g]=s.useState(!1);s.useEffect(()=>{N()},[]),s.useEffect(()=>{f()},[t,o,m]);const N=async()=>{try{const e=localStorage.getItem("token"),s=await i.get(`${a}/admin/submissions`,{headers:{Authorization:`Bearer ${e}`}});l(s.data.submissions||[])}catch(e){}finally{x(!1)}},f=()=>{let e=t;"all"!==o&&(e=e.filter(e=>e.submission_type===o)),"all"!==m&&(e=e.filter(e=>e.status===m)),d(e)},y=e=>new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),S=e=>({story:"Story",volunteer:"Volunteer",contributor:"Contributor",contact:"Contact"}[e]||e);return j?e.jsx("div",{className:"loading",children:"Loading submissions..."}):e.jsxs("div",{className:"admin-submissions-page",children:[e.jsxs("div",{className:"page-header",children:[e.jsx("h1",{children:"Review Submissions"}),e.jsxs("div",{className:"filters",children:[e.jsxs("select",{value:o,onChange:e=>u(e.target.value),children:[e.jsx("option",{value:"all",children:"All Types"}),e.jsx("option",{value:"story",children:"Stories"}),e.jsx("option",{value:"volunteer",children:"Volunteers"}),e.jsx("option",{value:"contributor",children:"Contributors"}),e.jsx("option",{value:"contact",children:"Contact"})]}),e.jsxs("select",{value:m,onChange:e=>h(e.target.value),children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"approved",children:"Approved"}),e.jsx("option",{value:"rejected",children:"Rejected"})]})]})]}),e.jsxs("div",{className:"submissions-layout",children:[e.jsx("div",{className:"submissions-list",children:0===n.length?e.jsx("div",{className:"empty-state",children:"No submissions found"}):n.map(s=>e.jsxs("div",{className:"submission-card "+((null==c?void 0:c.id)===s.id?"selected":""),onClick:()=>r(s),children:[e.jsxs("div",{className:"submission-header",children:[e.jsx("span",{className:"submission-type",children:S(s.submission_type)}),e.jsx("span",{className:`status-badge ${s.status}`,children:s.status})]}),e.jsx("h3",{children:s.submitter_name}),e.jsx("p",{className:"submission-email",children:s.submitter_email}),e.jsx("p",{className:"submission-date",children:y(s.created_at)})]},s.id))}),e.jsx("div",{className:"submission-detail",children:c?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"detail-header",children:[e.jsxs("h2",{children:[S(c.submission_type)," Submission"]}),e.jsx("button",{onClick:()=>(async e=>{if(confirm("Are you sure you want to delete this submission?"))try{const s=localStorage.getItem("token");await i.delete(`${a}/admin/submissions/${e}`,{headers:{Authorization:`Bearer ${s}`}}),l(t.filter(s=>s.id!==e)),(null==c?void 0:c.id)===e&&r(null)}catch(s){alert("Failed to delete submission")}})(c.id),className:"btn-delete-small",children:"Delete"})]}),e.jsxs("div",{className:"detail-content",children:[e.jsxs("div",{className:"detail-section",children:[e.jsx("label",{children:"Name:"}),e.jsx("p",{children:c.submitter_name})]}),e.jsxs("div",{className:"detail-section",children:[e.jsx("label",{children:"Email:"}),e.jsx("p",{children:c.submitter_email})]}),c.subject&&e.jsxs("div",{className:"detail-section",children:[e.jsx("label",{children:"Subject:"}),e.jsx("p",{children:c.subject})]}),e.jsxs("div",{className:"detail-section",children:[e.jsx("label",{children:"Message:"}),e.jsx("p",{className:"message-content",children:c.content})]}),c.metadata&&e.jsxs("div",{className:"detail-section",children:[e.jsx("label",{children:"Additional Info:"}),e.jsx("pre",{children:JSON.stringify(c.metadata,null,2)})]}),e.jsxs("div",{className:"detail-section",children:[e.jsx("label",{children:"Submitted:"}),e.jsx("p",{children:y(c.created_at)})]}),e.jsxs("div",{className:"detail-section",children:[e.jsx("label",{children:"Status:"}),e.jsx("span",{className:`status-badge ${c.status}`,children:c.status})]})]}),"pending"===c.status&&e.jsxs("div",{className:"action-section",children:[e.jsxs("div",{className:"feedback-input",children:[e.jsx("label",{children:"Feedback (optional):"}),e.jsx("textarea",{value:b,onChange:e=>p(e.target.value),placeholder:"Add feedback for the submitter...",rows:3})]}),e.jsxs("div",{className:"action-buttons",children:[e.jsx("button",{onClick:async()=>{if(c){g(!0);try{const e=localStorage.getItem("token");await i.put(`${a}/admin/submissions/${c.id}/approve`,{feedback:b||void 0},{headers:{Authorization:`Bearer ${e}`}}),l(t.map(e=>e.id===c.id?{...e,status:"approved"}:e)),r(null),p("")}catch(e){alert("Failed to approve submission")}finally{g(!1)}}},className:"btn-approve",disabled:v,children:v?"Processing...":"Approve"}),e.jsx("button",{onClick:async()=>{if(c){g(!0);try{const e=localStorage.getItem("token");await i.put(`${a}/admin/submissions/${c.id}/reject`,{feedback:b||void 0},{headers:{Authorization:`Bearer ${e}`}}),l(t.map(e=>e.id===c.id?{...e,status:"rejected"}:e)),r(null),p("")}catch(e){alert("Failed to reject submission")}finally{g(!1)}}},className:"btn-reject",disabled:v,children:v?"Processing...":"Reject"})]})]})]}):e.jsx("div",{className:"empty-detail",children:"Select a submission to view details"})})]})]})}export{t as default};
